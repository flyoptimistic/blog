---
title: 商城实战
date: 2022-05-01 10:04:06
tags: 
	- 项目实战
categories:
	- 项目实战


---

# 商城

## 准备工作

### 安装[Oracle VM VirtualBox](https://www.virtualbox.org/)虚拟机

[下载地址](https://www.virtualbox.org/wiki/Downloads)

### 安装[Vagrant](https://www.vagrantup.com/)

[下载地址](https://www.vagrantup.com/downloads)

### 安装[Docker](https://www.docker.com/)

[文档地址](https://docs.docker.com/get-docker/)

<!-- more -->

#### 卸载旧版本

~~~shell
$ sudo yum remove docker \
                  docker-client \
                  docker-client-latest \
                  docker-common \
                  docker-latest \
                  docker-latest-logrotate \
                  docker-logrotate \
                  docker-engine
~~~

#### 设置存储库

~~~shell
$ sudo yum install -y yum-utils

$ sudo yum-config-manager \
    --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo
~~~

#### 安装Docker引擎(此处下载较慢可查看下一节阿里云加速)

~~~shell
$ sudo yum install docker-ce docker-ce-cli containerd.io
#启动docker
$ sudo systemctl start docker
#查看docker版本
$ docker -v
#设置docker开机自启
$ sudo systemctl enable docker
~~~

#### 配置阿里云镜像加速

加速器地址：https://t92zxvdg.mirror.aliyuncs.com

##### 安装／升级Docker客户端

推荐安装1.10.0以上版本的Docker客户端，参考文档 [docker-ce](https://developer.aliyun.com/article/110806)

~~~shell
# step 1: 安装必要的一些系统工具
sudo yum install -y yum-utils device-mapper-persistent-data lvm2
# Step 2: 添加软件源信息
sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
# Step 3: 更新并安装 Docker-CE
sudo yum makecache fast
sudo yum -y install docker-ce
# Step 4: 开启Docker服务
sudo service docker start
~~~



##### 配置镜像加速器

针对Docker客户端版本大于 1.10.0 的用户，可以通过修改daemon配置文件/etc/docker/daemon.json来使用加速器

~~~shell
#创建目录
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": ["https://t92zxvdg.mirror.aliyuncs.com"]
}
EOF
#重新加载
sudo systemctl daemon-reload
sudo systemctl restart docker
~~~

### 安装[mysql](https://hub.docker.com/_/mysql?tab=tags)

#### 查询docker镜像

- [docker hub](https://hub.docker.com/):直接搜索自己需要的版本

- ~~~shell
  # 查找镜像
  $ docker search mysql
  ~~~

#### 下载镜像

~~~shell
# :后跟版本，不指定则默认为最新版
$ docker pull mysql:5.7
~~~



#### 创建容器并运行

~~~shell
$ docker run -p 3306:3306 --name mysql \
-v /mydata/mysql/log:/var/log/mysql \
-v /mydata/mysql/data:/var/lib/mysql \
-v /mydata/mysql/conf:/etc/mysql \
-e MYSQL_ROOT_PASSWORD=root \
-d mysql:5.7
~~~

- `-p 3306:3306` :将容器的 3306 端口映射到主机的 3306 端口。
- `--name` ：指定容器名称
- `-v /mydata/mysql/log:/var/log/mysql `:将主机的 /mydata/mysql/log目录挂载到容器的 /var/log/mysql目录。
- `-e MYSQL_ROOT_PASSWORD=root`:初始化root密码
- `-d mysql:5.7`:使用镜像mysql:5.7，以后台运行，并返回容器ID

#### 进入容器

~~~shell
$ docker exec -it mysql /bin/bash
#查看mysql文件
$ whereis mysql
~~~

#### 修改mysql默认字符集UTF-8配置

~~~shell
$ vim /mydata/mysql/conf/my.cnf
#修改完成后重启mysql
$ docker restart mysql
~~~

~~~properties
[client]
default-character-set=utf8

[mysql]
default-character-set=utf8

[mysqld]
init_connect='SET collation_connection = utf8_unicode_ci'
init_connect='SET NAMES utf8'
character-set-server=utf8
collation-server=utf8_unicode_ci
skip-character-set-client-handshake
skip-name-resolve
~~~

#### 设置自启动

~~~shell
$ docker update mysql --restart=always
~~~



### 安装[Redis](https://hub.docker.com/_/redis?tab=tags)

#### 下载redis最新镜像

~~~shell
$ docker pull redis
~~~

#### 创建配置文件

[官网配置](http://www.redis.cn/topics/config.html)

~~~shell
#创建目录
$ mkdir -p /mydata/redis/conf
#创建文件
$ touch /mydata/redis/conf/redis.conf
~~~

#### 修改配置文件



~~~shell
$ vim /mydata/redis/conf/redis.conf
# 开启aof持久化到硬盘
$ appendonly yes
~~~

#### 启动容器

~~~shell
docker run -p 6379:6379 --name redis \
-v /mydata/redis/data:/data \
-v /mydata/redis/conf/redis.conf:/etc/redis/redis.conf \
-d redis redis-server /etc/redis/redis.conf

~~~

#### 运行redis

~~~shell
$ docker exec -it redis redis-cli
~~~

#### 设置docker自启动

~~~shell
$ docker update redis --restart=always
~~~



### 安装[nodejs](https://nodejs.org/en/)

~~~shell
#查看版本号
$ node -v
#配置淘宝镜像
$ npm config set registry "https://registry.npm.taobao.org"

~~~







